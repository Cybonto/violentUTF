[tool:pytest]
testpaths = .
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts = 
    -v
    --tb=short
    --strict-markers
    --disable-warnings
markers =
    unit: Unit tests (direct FastAPI)
    integration: Integration tests (through APISIX)
    endpoint: Endpoint verification tests
    slow: Slow tests that require external services
    security: Security-related tests

# Fix pytest-asyncio warning
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# Environment variables for testing
env = 
    APP_DATA_DIR = ./tests/test_data
    CONFIG_DIR = ./tests/test_config
    JWT_SECRET_KEY = test-secret-key-for-unit-tests
    SECRET_KEY = test-secret-key
    APISIX_GATEWAY_SECRET = test-gateway-secret
    KEYCLOAK_URL = http://localhost:8080
    KEYCLOAK_REALM = test-realm
    KEYCLOAK_CLIENT_ID = test-client
    API_BASE_URL = http://localhost:8000
    DATABASE_URL = sqlite+aiosqlite:///./tests/test.db
    ASYNC_DATABASE_URL = sqlite+aiosqlite:///./tests/test.db
    PYTHONPATH = .