# Pre-commit Configuration Version Control

This document tracks changes to the pre-commit configuration to enable better debugging and consistency checking.

## Version History

### v1.1.0 - 2025-08-26
- **Fixed test naming pattern exclusions**: Added exclusions for utility files (`_helper.py`, `_util.py`)
- **Resolved shebang permission issues**: Fixed 25+ files with missing executable permissions
- **Fixed JSON validation**: Corrected empty bandit-report.json files
- **Core hooks passing**: check-json, check-yaml, check-shebang-scripts-are-executable, name-tests-test

### Configuration Changes:
```yaml
# Added exclusions for utility files in tests directory
- id: name-tests-test
  args: ["--pytest-test-first"]
  exclude: "_helper\\.py$|_util\\.py$|keycloak_auth_helper\\.py$|contract_test_helper\\.py$"
```

### Files Fixed:
- **Shebang permissions**: 25+ files (tests, scripts, API helpers)
- **JSON validation**: bandit-report.json, bandit-report-fixed.json
- **Test naming patterns**: Excluded utility files from test naming requirements

### Hook Status:
‚úÖ **Passing Hooks:**
- check-json, check-yaml, check-shebang-scripts-are-executable
- name-tests-test, check-ast, check-case-conflict
- check-executables-have-shebangs, detect-private-key
- end-of-file-fixer (auto-fixes), trailing-whitespace (auto-fixes)

üîÑ **Hooks Needing Attention:**
- mypy: Type annotation issues in MCP auth module
- black: Formatting issues (can auto-fix)
- bandit: Security analysis may need baseline updates

### Process Improvements Implemented:
1. ‚úÖ Systematic shebang permission fixing with automated script
2. ‚úÖ JSON validation error resolution
3. ‚úÖ Test pattern exclusion for utility files
4. üîÑ Version control tracking (this document)
5. ‚è≥ Environment consistency checks (pending)

## Maintenance Guidelines

### Before Major Changes:
1. Save current .pre-commit-config.yaml with timestamp
2. Document changes in this file
3. Test individual hooks before full validation
4. Keep track of exclusion patterns and their rationale

### Debugging Process:
1. Run individual hooks to isolate issues: `pre-commit run <hook-id> --all-files`
2. Check hook configuration in .pre-commit-config.yaml
3. Review exclusion patterns for false positives
4. Test on subset of files first: `pre-commit run --files <file1> <file2>`

### Hook Priority Levels:
- **Critical**: check-json, check-yaml, check-shebang-scripts-are-executable
- **Important**: flake8, mypy, bandit, detect-secrets
- **Quality**: black, isort, pylint, markdownlint
- **Documentation**: insert-license, prettier

## Environment Consistency

### Python Version**: 3.12 (specified in default_language_version)
### Key Dependencies:
- pre-commit-hooks: v4.5.0
- black: 23.12.1
- isort: 5.13.2
- flake8: 6.1.0
- mypy: 1.17.1
- bandit: 1.7.5

### Repository Structure Assumptions:
- Test files in `tests/` directory
- Utility files end with `_helper.py` or `_util.py`
- API tests in `tests/api_tests/`
- Scripts in `scripts/` directory
- Application code in `app/` and `violentutf_api/fastapi_app/`
